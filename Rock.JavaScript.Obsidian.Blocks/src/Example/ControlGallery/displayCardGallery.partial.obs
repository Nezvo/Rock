<template>
    <GalleryAndResult :importCode="importCode" :exampleCode="exampleCode" enableReflection>

        <DisplayCard :aside="aside"
                     :asideIconCssClass="asideIconCssClass"
                     :badgeText="badgeText"
                     :badgeType="badgeType"
                     :iconCssClass="iconCssClass"
                     :iconLabelType="iconLabelCssClass || iconLabelType"
                     :description="description"
                     :primaryActions="primaryActions"
                     :secondaryActions="secondaryActions"
                     :title="title"
                     :onClick="simulateNotClickable ? undefined : onClick">

            <template v-if="simulateActionsSlot" #actions>
                <RockButton :btnType="BtnType.Link" @click.stop="onClick('Subscribe')">Subscribe</RockButton>
            </template>

            <template v-if="simulatePrependSlot" #prepend>
                Prepend Slot Content
            </template>

            <template v-if="simulateDescriptionSlot" #description>
                <div>
                    <i class="ti ti-clock"></i> {{ description }}
                </div>
            </template>

        </DisplayCard>

        <template #settings>
            <div class="row">
                <TextBox v-model="badgeText" formGroupClasses="col-md-4" label="Badge Text" />
                <DropDownList v-model="badgeType" :items="badgeTypes" :showBlankItem="false" formGroupClasses="col-md-4" label="Badge Type" />
                <IconPicker v-model="iconCssClass" formGroupClasses="col-md-4" label="Icon CSS Class" />
                <DropDownList v-model="iconLabelType" :items="labelTypes" :showBlankItem="false" formGroupClasses="col-md-4" label="Icon Label Type" />
                <TextBox v-if="iconLabelType === 'custom'" v-model="iconLabelCssClass" formGroupClasses="col-md-4 col-md-offset-8" label="Icon Label Custom Class" />
            </div>

            <div class="row">
                <TextBox v-model="title" formGroupClasses="col-md-4" label="Title" />
                <TextBox v-model="description" formGroupClasses="col-md-4" label="Description" />
            </div>

            <div class="row">
                <IconPicker v-model="asideIconCssClass" formGroupClasses="col-md-4" label="Aside Icon CSS Class" />
                <TextBox v-model="aside" formGroupClasses="col-md-4" label="Aside" />
            </div>

            <CheckBoxList v-model="simulateValues" label="Simulate" :items="simulateOptions" horizontal :repeatColumns="4" />
        </template>
    </GalleryAndResult>
</template>

<script setup lang="ts">
    import { computed, ref, watch } from "vue";
    import GalleryAndResult from "./common/galleryAndResult.partial.obs";
    import CheckBoxList from "@Obsidian/Controls/checkBoxList.obs";
    import DisplayCard from "@Obsidian/Controls/displayCard.obs";
    import DropDownList from "@Obsidian/Controls/dropDownList.obs";
    import TextBox from "@Obsidian/Controls/textBox.obs";
    import IconPicker from "@Obsidian/Controls/iconPicker.obs";
    import RockButton from "@Obsidian/Controls/rockButton.obs";
    import { BtnType } from "@Obsidian/Enums/Controls/btnType";
    import { MenuAction } from "@Obsidian/Types/Controls/dropDownMenu";
    import { ListItemBag } from "@Obsidian/ViewModels/Utility/listItemBag";
    import { BadgeType } from "@Obsidian/Enums/Controls/badgeType";

    const labelTypes: ListItemBag[] = [
        { text: "Default", value: "default" },
        { text: "Primary", value: "primary" },
        { text: "Success", value: "success" },
        { text: "Info", value: "info" },
        { text: "Warning", value: "warning" },
        { text: "Danger", value: "danger" },
        { text: "Custom", value: "custom" },
    ];

    const badgeTypes: ListItemBag[] = [
        { text: "Success", value: BadgeType.Success },
        { text: "Info", value: BadgeType.Info },
        { text: "Warning", value: BadgeType.Warning },
        { text: "Danger", value: BadgeType.Danger },
        { text: "Critical", value: BadgeType.Critical },
    ];

    const importCode = `import DisplayCard from "@Obsidian/Controls/displayCard.obs";`;

    const aside = ref<string>("hello@triumph.tech");
    const asideIconCssClass = ref<string>("ti ti-user");
    const badgeText = ref<string>("Step 3");
    const badgeType = ref<BadgeType>(BadgeType.Success);
    const iconCssClass = ref<string>("ti ti-chart-line");
    const iconLabelType = ref<"default" | "primary" | "success" | "info" | "warning" | "danger" | "custom">("info");
    const iconLabelCssClass = ref<string>("");
    const description = ref<string>("This step calculates weekly growth based on new signups.");
    const title = ref<string>("Growth Metrics");
    const simulateValues = ref<string[]>([]);

    const primaryActions = computed<MenuAction[] | null>(() => {
        if (!simulateValues.value.includes("primaryActions")) {
            return [];
        }

        return [
            {
                iconCssClass: "ti ti-edit",
                title: "Edit",
                type: "default",
                handler: () => onClick("Edit"),
            },
            {
                iconCssClass: "ti ti-copy",
                title: "Duplicate",
                type: "default",
                handler: () => onClick("Duplicate"),
            }
        ];
    });

    const secondaryActions = computed<MenuAction[] | null>(() => {
        if (!simulateValues.value.includes("secondaryActions")) {
            return [];
        }

        return [
            {
                iconCssClass: "ti ti-trash",
                title: "Delete",
                type: "default",
                handler: () => onClick("Delete"),
            }
        ];
    });

    const simulateOptions = [
        {
            value: "primaryActions",
            text: "Primary Actions"
        },
        {
            value: "secondaryActions",
            text: "Secondary Actions"
        },
        {
            value: "actions",
            text: "Actions Slot"
        },
        {
            value: "prepend",
            text: "Prepend Slot"
        },
        {
            value: "description",
            text: "Description Slot"
        },
        {
            value: "notClickable",
            text: "Not Clickable"
        }
    ];

    const simulateActionsSlot = computed((): boolean => simulateValues.value.includes("actions"));

    const simulatePrependSlot = computed((): boolean => simulateValues.value.includes("prepend"));

    const simulateDescriptionSlot = computed((): boolean => simulateValues.value.includes("description"));

    const anySlotsSimulated = computed((): boolean => {
        return simulateActionsSlot.value
            || simulatePrependSlot.value
            || simulateDescriptionSlot.value;
    });

    const simulateNotClickable = computed((): boolean => simulateValues.value.includes("notClickable"));

    const exampleCode = computed<string>(() => {
        return `<DisplayCard aside="${aside.value}"
             asideIconCssClass="${asideIconCssClass.value}"
             badgeText="${badgeText.value}"
             badgeType="${badgeType.value}"
             iconCssClass="${iconCssClass.value}"
             iconLabelType="${iconLabelCssClass.value || iconLabelType.value}"
             description="${description.value}"
             :primaryActions="${JSON.stringify(primaryActions.value, null, 2).replace(/\n/g, "\n                   ").replace(/"/g, "'")}"
             :secondaryActions="${JSON.stringify(secondaryActions.value, null, 2).replace(/\n/g, "\n                   ").replace(/"/g, "'")}"
             title="${title.value}"${!simulateNotClickable.value ? `
             @click="onClick"` : ""}${anySlotsSimulated.value ? `>${simulateActionsSlot.value ? `
    <template #actions>
        <RockButton :btnType="BtnType.Link" @click.stop="onSubscribe">
            Subscribe
        </RockButton>
    </template>` : ""}${simulatePrependSlot.value ? `
    <template #prepend>
        Prepend Slot Content
    </template>` : ""}${simulateDescriptionSlot.value ? `
    <template #description>
        <i class="ti ti-clock"></i> ${description.value}
    </template>` : ""}
</DisplayCard>` : " />"}`;
    });

    function onClick(item?: string): void {
        alert(`${item ?? "Item"} clicked!`);
    }

    watch(iconLabelType, (newValue) => {
        if (newValue !== "custom") {
            iconLabelCssClass.value = "";
        }
    });
</script>
